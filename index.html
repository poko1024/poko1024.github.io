<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRChat プレイ時間分析ツール</title>

    <meta property="og:title" content="VRChat プレイ時間分析ツール">
    <meta property="og:description" content="VRChatのプレイ開始日、総プレイ時間、生年月日を入力すると、VRChatプレイ時間の詳細や人生に占める割合などを楽しく分析できます。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://poko1024.github.io/">
    <meta property="og:image" content="https://poko1024.github.io/thumbnail.png">
    <meta property="og:site_name" content="VRChat プレイ時間分析ツール">
    <meta property="og:locale" content="ja_JP">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="VRChat プレイ時間分析ツール">
    <meta name="twitter:description" content="VRChatのプレイ開始日、総プレイ時間、生年月日を入力すると、VRChatプレイ時間の詳細や人生に占める割合などを楽しく分析できます。">
    <meta name="twitter:image" content="https://poko1024.github.io/thumbnail.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .creator-credit {
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
            width: 100%;
            padding-top: 0.5rem; 
            margin-bottom: 0.5rem;
        }
        .container {
            max-width: 700px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 2rem; 
            padding: 2.5rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .input-group legend, .input-group > label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }
        .date-inputs {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .input-field {
            padding: 0.85rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
            text-align: center;
            font-size: 0.95rem;
        }
        .input-field:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        .input-year { width: 6rem; }
        .input-month-day { width: 4.5rem; }
        #vrchatPlayTime {
            width: 11rem;
        }
        .btn {
            display: inline-block;
            padding: 0.85rem 1.75rem;
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            border: none;
            width: 100%;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn:hover {
            background-color: #4338ca;
        }
        .btn:active {
            transform: translateY(1px);
        }
        .btn-copy {
            background-color: #0ea5e9;
            margin-top: 1.5rem;
        }
        .btn-copy:hover {
            background-color: #0284c7;
        }
        .results-card {
            margin-top: 2.5rem;
            padding: 2rem;
            background-color: #f9fafb;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
        }
        .results-card h3 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #111827;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.75rem;
        }
        .result-item {
            margin-bottom: 1.75rem;
            font-size: 1rem;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .result-item.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .result-item strong {
            font-weight: 600;
            color: #374151;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.05rem;
        }
        .result-item .value-span, .result-item .ymd-value-span span {
            color: #4f46e5;
            font-weight: bold;
        }
         .result-item .value-span {
             padding-left: 0.5rem;
         }
        .percent-large {
            font-size: 1.6em;
            font-weight: 700;
            color: #4f46e5;
            display: inline-block;
            margin-bottom: 0.5rem;
            padding-left: 0.5rem;
        }
        .overflow-indicator {
            font-size: 0.6em;
            color: #ef4444;
            margin-left: 0.25rem;
            font-weight: normal;
            vertical-align: middle;
        }
        .ratio-details {
            font-size: 0.95rem;
            color: #4b5563;
            padding-left: 0.5rem;
            margin-top: 0.25rem;
        }
        .ratio-detail-item {
            display: inline-block;
            margin-right: 1.25rem;
            align-items: center;
        }
        .boxed-value {
            border: 1px solid #d1d5db;
            padding: 0.2rem 0.5rem;
            border-radius: 0.375rem;
            background-color: #eef2ff;
            display: inline-block;
            margin-left: 0.35rem;
        }
        .boxed-value .animated-value {
            font-weight: bold;
            color: #4f46e5;
        }
        .result-sub-item {
            padding-left: 1rem;
            margin-bottom: 0.6rem;
            font-size: 0.95rem;
        }
        .result-sub-item strong {
            font-weight: 500;
            color: #4b5563;
        }
        .current-date-display {
            font-size: 0.85em;
            color: #6b7280;
            text-align: right;
            margin-top: 1rem;
            opacity: 0;
            transition: opacity 0.5s ease-out 0.2s;
        }
        .current-date-display.is-visible {
            opacity: 1;
        }
        .error-message {
            color: #ef4444;
            background-color: #fee2e2;
            border: 1px solid #fca5a5;
            padding: 0.85rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
            font-size: 0.95rem;
        }
        .optional-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-left: 0.5rem;
            font-weight: normal;
        }
        .ratio-bar-container {
            width: 100%;
            height: 14px;
            background-color: #e5e7eb;
            border-radius: 7px;
            margin-top: 0.75rem;
            overflow: hidden;
        }
        .ratio-bar {
            width: 0%;
            height: 100%;
            background-color: #6366f1;
            border-radius: 7px;
            transition: width 1.2s ease-out;
        }
        #qualificationSuggestionSection .qualification-card {
            margin-top: 0.75rem;
            padding: 1.25rem;
            background-color: #fef3c7;
            border-radius: 0.5rem;
            border: 1px solid #fde68a;
        }
        #qualificationSuggestionSection .qualification-name {
            font-size: 1.15rem;
            font-weight: 700;
            color: #b45309;
        }
        #qualificationSuggestionSection .qualification-study-time {
            font-size: 0.875rem;
            color: #78350f;
            margin-top: 0.35rem;
        }
        #qualificationSuggestionSection .qualification-description {
            font-size: 0.925rem;
            color: #374151;
            margin-top: 0.6rem;
            line-height: 1.65;
        }

        @media (max-width: 640px) {
            body { padding: 0.5rem; }
            .creator-credit { margin-bottom: 0.25rem; padding-top: 0.25rem;}
            .container { margin-top: 1rem; margin-bottom: 1rem; padding: 1.5rem; }
            .date-inputs { flex-wrap: wrap; gap: 0.5rem; }
            .input-year, .input-month-day, #vrchatPlayTime { width: 100%; margin-bottom: 0.5rem;}
            .date-inputs span.text-gray-500 { margin: 0 0.25rem; }
            .ratio-detail-item { display: block; margin-right: 0; margin-bottom: 0.5rem; }
            .current-date-display { text-align: center; margin-top: 1.5rem; }
            .results-card h3 { font-size: 1.25rem; }
            .percent-large { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="creator-credit">Created by, poko_VRC</div>
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-10 text-indigo-700">VRChat プレイ時間分析ツール</h1>

        <div class="space-y-8">
            <fieldset class="input-group">
                <legend>VRChatを始めた日:</legend>
                <div class="date-inputs">
                    <input type="number" id="vrchatStartYear" class="input-field input-year" placeholder="YYYY" min="2000" max="2100">
                    <span class="text-gray-500">年</span>
                    <input type="number" id="vrchatStartMonth" class="input-field input-month-day" placeholder="MM" min="1" max="12">
                    <span class="text-gray-500">月</span>
                    <input type="number" id="vrchatStartDay" class="input-field input-month-day" placeholder="DD" min="1" max="31">
                    <span class="text-gray-500">日</span>
                </div>
            </fieldset>
            <div class="input-group">
                <label for="vrchatPlayTime">VRChatの総プレイ時間 (時間):</label>
                <input type="number" id="vrchatPlayTime" class="input-field" placeholder="例: 1500" min="0">
            </div>
            <fieldset class="input-group">
                <legend>あなたの生年月日 <span class="optional-text">(任意入力)</span></legend>
                <div class="date-inputs">
                    <input type="number" id="birthYear" class="input-field input-year" placeholder="YYYY" min="2000" max="2100">
                    <span class="text-gray-500">年</span>
                    <input type="number" id="birthMonth" class="input-field input-month-day" placeholder="MM" min="1" max="12">
                    <span class="text-gray-500">月</span>
                    <input type="number" id="birthDay" class="input-field input-month-day" placeholder="DD" min="1" max="31">
                    <span class="text-gray-500">日</span>
                </div>
            </fieldset>
        </div>

        <button id="calculateButton" class="btn mt-10">計算する</button>
        <div id="errorDisplay" class="error-message hidden mt-6"></div>

        <div id="resultsArea" class="results-card hidden">
            <h3>計算結果:</h3>
            <div id="totalTimeSection" class="result-item">
                <strong>VRChat開始からの総経過時間:</strong>
                <div class="result-sub-item">
                    <strong>年・月・日:</strong>
                    <span class="ymd-value-span">
                        <span id="totalTimeYears">0</span>年
                        <span id="totalTimeMonthsVal">0</span>ヶ月
                        <span id="totalTimeDaysVal">0</span>日
                    </span>
                </div>
                <div class="result-sub-item">
                    <strong>総月数:</strong> <span id="totalTimeMonths" class="value-span">0.0 ヶ月</span>
                </div>
                <div class="result-sub-item">
                    <strong>総日数:</strong> <span id="totalTimeDays" class="value-span">0.0 日</span>
                </div>
                <div class="result-sub-item">
                    <strong>総時間数:</strong> <span id="totalTimeHours" class="value-span">0.0 時間</span>
                </div>
            </div>
            <div id="playRatioSection" class="result-item">
                <strong>VRChatを始めてからのプレイ時間比率:</strong>
                <span id="ratioPlayToTotalSinceStartPercent" class="percent-large">0.00 %</span>
                <span id="playRatioOverflow" class="overflow-indicator hidden">(Overflowing)</span>
                <div class="ratio-bar-container">
                    <div id="ratioPlayBar" class="ratio-bar"></div>
                </div>
                <div class="ratio-details">
                    <span class="ratio-detail-item">日数: <span class="boxed-value">
                        <span id="ratioPlayDaysVal" class="animated-value">0</span>日 / <span id="ratioPlayDaysTotal" class="animated-value">0</span>日
                    </span></span>
                    <span class="ratio-detail-item">時間: <span class="boxed-value">
                        <span id="ratioPlayHoursVal" class="animated-value">0</span>時間 / <span id="ratioPlayHoursTotal" class="animated-value">0</span>時間
                    </span></span>
                </div>
            </div>
            <div id="lifeRatioSection" class="result-item hidden">
                <strong>あなたの人生に対するプレイ時間比率:</strong>
                <span id="ratioPlayToLifePercent" class="percent-large">0.00 %</span>
                <span id="lifeRatioOverflow" class="overflow-indicator hidden">(Overflowing)</span>
                <div class="ratio-bar-container">
                    <div id="ratioLifeBar" class="ratio-bar"></div>
                </div>
                 <div class="ratio-details">
                    <span class="ratio-detail-item">日数: <span class="boxed-value">
                        <span id="ratioLifeDaysVal" class="animated-value">0</span>日 / <span id="ratioLifeDaysTotal" class="animated-value">0</span>日
                    </span></span>
                    <span class="ratio-detail-item">時間: <span class="boxed-value">
                        <span id="ratioLifeHoursVal" class="animated-value">0</span>時間 / <span id="ratioLifeHoursTotal" class="animated-value">0</span>時間
                    </span></span>
                </div>
            </div>
             <div id="qualificationSuggestionSection" class="result-item hidden">
                <strong id="qualificationIntroText"></strong>
                <div id="qualificationCardsContainer"></div>
            </div>
            <div id="currentDateDisplay" class="current-date-display"></div>
            <button id="copyButton" class="btn btn-copy hidden">結果をコピーする</button>
        </div>
    </div>

    <script>
        const calculateButton = document.getElementById('calculateButton');
        const resultsArea = document.getElementById('resultsArea');
        const errorDisplay = document.getElementById('errorDisplay');
        const copyButton = document.getElementById('copyButton'); 

        const totalTimeSection = document.getElementById('totalTimeSection');
        const playRatioSection = document.getElementById('playRatioSection');
        const lifeRatioSection = document.getElementById('lifeRatioSection');
        const qualificationSuggestionSection = document.getElementById('qualificationSuggestionSection');
        const qualificationCardsContainer = document.getElementById('qualificationCardsContainer');
        const currentDateDisplay = document.getElementById('currentDateDisplay');

        const vrchatStartYearInput = document.getElementById('vrchatStartYear');
        const vrchatStartMonthInput = document.getElementById('vrchatStartMonth');
        const vrchatStartDayInput = document.getElementById('vrchatStartDay');
        const vrchatPlayTimeInput = document.getElementById('vrchatPlayTime');
        const birthYearInput = document.getElementById('birthYear');
        const birthMonthInput = document.getElementById('birthMonth');
        const birthDayInput = document.getElementById('birthDay');

        const totalTimeYearsDisplay = document.getElementById('totalTimeYears');
        const totalTimeMonthsValDisplay = document.getElementById('totalTimeMonthsVal');
        const totalTimeDaysValDisplay = document.getElementById('totalTimeDaysVal');
        const totalTimeMonthsDisplay = document.getElementById('totalTimeMonths');
        const totalTimeDaysDisplay = document.getElementById('totalTimeDays');
        const totalTimeHoursDisplay = document.getElementById('totalTimeHours');
        const ratioPlayToTotalSinceStartPercentDisplay = document.getElementById('ratioPlayToTotalSinceStartPercent');
        const playRatioOverflowDisplay = document.getElementById('playRatioOverflow'); 
        const ratioPlayDaysValDisplay = document.getElementById('ratioPlayDaysVal');
        const ratioPlayDaysTotalDisplay = document.getElementById('ratioPlayDaysTotal');
        const ratioPlayHoursValDisplay = document.getElementById('ratioPlayHoursVal');
        const ratioPlayHoursTotalDisplay = document.getElementById('ratioPlayHoursTotal');

        const ratioPlayToLifePercentDisplay = document.getElementById('ratioPlayToLifePercent');
        const lifeRatioOverflowDisplay = document.getElementById('lifeRatioOverflow'); 
        const ratioLifeDaysValDisplay = document.getElementById('ratioLifeDaysVal');
        const ratioLifeDaysTotalDisplay = document.getElementById('ratioLifeDaysTotal');
        const ratioLifeHoursValDisplay = document.getElementById('ratioLifeHoursVal');
        const ratioLifeHoursTotalDisplay = document.getElementById('ratioLifeHoursTotal');
        const ratioPlayBar = document.getElementById('ratioPlayBar');
        const ratioLifeBar = document.getElementById('ratioLifeBar');

        const qualificationIntroTextDisplay = document.getElementById('qualificationIntroText');

        const MS_PER_HOUR = 1000 * 60 * 60;
        const MS_PER_DAY = MS_PER_HOUR * 24;
        const DAYS_PER_YEAR_AVG = 365.25;
        const DAYS_PER_MONTH_AVG = DAYS_PER_YEAR_AVG / 12;
        
        const BASE_ANIMATION_DURATION = 1500; 
        const YMD_ITEM_ANIM_DURATION = 1000;  
        const ITEM_ANIM_DELAY = 300; 
        const SECTION_FADE_IN_DELAY = 150;
        const DELAY_AFTER_TOTAL_TIME_SECTION = 400; 
        const DELAY_AFTER_RATIO_SECTION = 300;

        let lastCalculatedResults = null;

        const qualifications = [
            { name: "危険物取扱者乙種4類", minHours: 40, maxHours: 80, description: "ガソリン、灯油など引火性液体の取り扱いや保安監督ができる国家資格。ガソリンスタンド等で需要があります。" },
            { name: "日商簿記3級", minHours: 60, maxHours: 100, description: "基本的な商業簿記を修得し、経理関連書類の適切な処理や青色申告書類の作成など、初歩的な実務ができるようになります。" },
            { name: "FP技能士3級", minHours: 80, maxHours: 120, description: "くらしとお金に関する幅広い知識を学び、個人の夢や目標に基づくライフプラン実現を支援します。" },
            { name: "ITパスポート試験", minHours: 90, maxHours: 150, description: "ITを利活用するすべての方が対象の、情報処理の基礎知識を証明する国家試験です。" },
            { name: "第二種電気工事士", minHours: 150, maxHours: 250, description: "一般住宅や小規模店舗などの電気工事を行うために必要な国家資格です。" },
            { name: "FP技能士2級・AFP", minHours: 180, maxHours: 280, description: "FP3級より専門的な知識・技能を習得し、顧客のニーズに応じた適切なファイナンシャル・プランニングができます。" },
            { name: "基本情報技術者試験", minHours: 200, maxHours: 320, description: "ITエンジニアの登竜門。情報技術全般に関する基本的な知識・技能を体系的に習得していることを証明します。" },
            { name: "日商簿記2級", minHours: 250, maxHours: 380, description: "高度な商業簿記・工業簿記（原価計算を含む）を修得し、財務諸表の数字から経営内容を把握できます。" },
            { name: "宅地建物取引士 (宅建士)", minHours: 300, maxHours: 450, description: "不動産取引の専門家。宅地建物の売買、交換、賃借の代理・媒介などを行う際に重要事項の説明等を行います。" },
            { name: "第一種電気工事士", minHours: 350, maxHours: 550, description: "ビルや工場など、より大規模な電気工作物の工事に従事できる国家資格です。" },
            { name: "通関士", minHours: 400, maxHours: 580, description: "輸出入貨物の通関手続きを行う専門家。貿易関連企業で需要があります。" },
            { name: "技術士第一次試験 (情報工学部門など)", minHours: 420, maxHours: 600, description: "科学技術に関する高度な専門知識と応用能力を認定する国家資格の第一歩です。" },
            { name: "応用情報技術者試験", minHours: 450, maxHours: 680, description: "基本情報技術者の上位資格。ITを活用した戦略立案や、システムの設計・開発・運用などにおいて中心的な役割を担えることを証明します。" },
            { name: "日商簿記1級", minHours: 550, maxHours: 790, description: "極めて高度な商業簿記・会計学・工業簿記・原価計算を修得し、会計基準や会社法、財務諸表等規則を踏まえ、経営管理や経営分析ができます。" },
            { name: "行政書士", minHours: 600, maxHours: 840, description: "官公署に提出する書類や権利義務・事実証明に関する書類の作成、提出手続代理などを行う法律の専門家です。" },
            { name: "電験三種 (第三種電気主任技術者)", minHours: 700, maxHours: 890, description: "ビルや工場などの高圧電気設備の保安監督ができる国家資格。電気設備の維持・運用に不可欠です。" },
            { name: "情報処理安全確保支援士", minHours: 750, maxHours: 940, description: "サイバーセキュリティ対策を推進する国家資格。情報システムの安全確保に関する専門知識・技能を証明します。" },
            { name: "社会保険労務士 (社労士)", minHours: 900, maxHours: 1300, description: "労働・社会保険に関する法律、人事・労務管理の専門家として、企業経営の健全な発展と労働者等の福祉向上に貢献します。" },
            { name: "中小企業診断士", minHours: 1000, maxHours: 1500, description: "中小企業の経営課題に対応するための診断・助言を行う専門家。経営戦略、財務、人事など幅広い知識が求められます。" },
            { name: "TOEIC L&R TEST 900点", minHours: 1000, maxHours: 2000, description: "英語でのコミュニケーション能力を測るテストで、900点以上はネイティブに近いレベルとされます。(現在の英語力により大きく変動)" },
            { name: "不動産鑑定士", minHours: 1800, maxHours: 2800, description: "不動産の経済価値を判定する専門家。公的評価やコンサルティングなどを行います。" },
            { name: "税理士 (5科目合格)", minHours: 2800, maxHours: 4000, description: "税務に関する専門家として、税務代理、税務書類の作成、税務相談などを行います。" },
            { name: "公認会計士", minHours: 3000, maxHours: 4500, description: "会計監査の専門家であり、財務諸表の監査や会計、税務、コンサルティング業務などを行います。" },
            { name: "司法書士", minHours: 3200, maxHours: 4200, description: "不動産登記や商業登記、供託の手続き代理、裁判所や検察庁、法務局に提出する書類作成などを行う法律の専門家です。" },
            { name: "弁理士", minHours: 3400, maxHours: 4400, description: "特許、実用新案、意匠、商標などの知的財産権の取得や紛争解決を専門とする国家資格者です。" },
            { name: "司法試験 (予備試験ルート)", minHours: 5000, maxHours: 10000, description: "裁判官、検察官、弁護士になるための国家資格。予備試験ルートは法科大学院修了者以外も受験可能です。" }
        ].sort((a, b) => a.minHours - b.minHours);


        function easeOutCubic(t) {
            return (--t) * t * t + 1;
        }

        function getDateFromInputs(yearInputId, monthInputId, dayInputId, fieldName) {
            const year = parseInt(document.getElementById(yearInputId).value);
            const month = parseInt(document.getElementById(monthInputId).value);
            const day = parseInt(document.getElementById(dayInputId).value);

            if (isNaN(year) || isNaN(month) || isNaN(day)) {
                if (fieldName.includes("生年月日") && !document.getElementById(yearInputId).value && !document.getElementById(monthInputId).value && !document.getElementById(dayInputId).value) {
                    return null;
                }
                showError(`${fieldName}の年・月・日をすべて入力してください。`); return null;
            }
            if (month < 1 || month > 12) {
                showError(`${fieldName}の月は1から12の間で入力してください。`); return null;
            }
            const daysInMonth = new Date(year, month, 0).getDate();
            if (day < 1 || day > daysInMonth) {
                showError(`${fieldName}の日は1から${daysInMonth}の間で入力してください (${year}年${month}月)。`); return null;
            }
            const dateObj = new Date(year, month - 1, day);
            if (dateObj.getFullYear() !== year || dateObj.getMonth() !== month - 1 || dateObj.getDate() !== day) {
                showError(`${fieldName}に存在しない日付が入力されています。`); return null;
            }
            return dateObj;
        }

        function animateCountUp(element, endValue, duration, decimalPlaces = 0, unit = '', startValue = 0) {
            return new Promise(resolve => {
                if (!element) { 
                    resolve();
                    return;
                }
                if (duration <= 0) {
                    element.textContent = `${endValue.toFixed(decimalPlaces)}${unit}`;
                    resolve();
                    return;
                }
                let startTime = null;

                function animationStep(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const progress = Math.min((timestamp - startTime) / duration, 1);
                    const easedProgress = easeOutCubic(progress);
                    const currentValue = startValue + (endValue - startValue) * easedProgress;
                    element.textContent = `${currentValue.toFixed(decimalPlaces)}${unit}`;
                    if (progress < 1) {
                        requestAnimationFrame(animationStep);
                    } else {
                        element.textContent = `${endValue.toFixed(decimalPlaces)}${unit}`;
                        resolve();
                    }
                }
                requestAnimationFrame(animationStep);
            });
        }
        
        async function animateYMDDisplayCombined(targetYMD) {
            const { years, months, days } = targetYMD;
            await Promise.all([
                animateCountUp(totalTimeYearsDisplay, years, YMD_ITEM_ANIM_DURATION, 0),
                animateCountUp(totalTimeMonthsValDisplay, months, YMD_ITEM_ANIM_DURATION, 0),
                animateCountUp(totalTimeDaysValDisplay, days, YMD_ITEM_ANIM_DURATION, 0)
            ]);
        }

        function animateBar(barElement, percentage) {
            if (!barElement) {
                return;
            }
            requestAnimationFrame(() => {
                   barElement.style.width = `${Math.min(100, Math.max(0, percentage))}%`;
            });
        }
        
        async function showElementWithAnimation(element, delay = SECTION_FADE_IN_DELAY) {
            if (!element) return;
            return new Promise(resolve => {
                element.classList.remove('hidden');
                requestAnimationFrame(() => { 
                    setTimeout(() => { 
                        element.classList.add('is-visible');
                        resolve();
                    }, delay); 
                });
            });
        }


        calculateButton.addEventListener('click', async () => {
            errorDisplay.classList.add('hidden');
            errorDisplay.textContent = '';
            resultsArea.classList.add('hidden');
            copyButton.classList.add('hidden'); 
            lastCalculatedResults = null; 
            
            [totalTimeSection, playRatioSection, lifeRatioSection, qualificationSuggestionSection, currentDateDisplay].forEach(el => {
                if(el) {
                    el.classList.remove('is-visible');
                    if (el.id === 'lifeRatioSection' || el.id === 'qualificationSuggestionSection') {
                         el.classList.add('hidden');
                    }
                }
            });
            if(qualificationCardsContainer) qualificationCardsContainer.innerHTML = ''; 
            if(playRatioOverflowDisplay) playRatioOverflowDisplay.classList.add('hidden');
            if(lifeRatioOverflowDisplay) lifeRatioOverflowDisplay.classList.add('hidden');


            if(ratioPlayBar) {
                ratioPlayBar.style.transition = 'none';
                ratioPlayBar.style.width = '0%';
                requestAnimationFrame(() => ratioPlayBar.style.transition = 'width 1.2s ease-out');
            }
            if(ratioLifeBar) {
                ratioLifeBar.style.transition = 'none';
                ratioLifeBar.style.width = '0%';
                requestAnimationFrame(() => ratioLifeBar.style.transition = 'width 1.2s ease-out');
            }
            
            if(totalTimeYearsDisplay) totalTimeYearsDisplay.textContent = '0';
            if(totalTimeMonthsValDisplay) totalTimeMonthsValDisplay.textContent = '0';
            if(totalTimeDaysValDisplay) totalTimeDaysValDisplay.textContent = '0';
            if(totalTimeMonthsDisplay) totalTimeMonthsDisplay.textContent = '0.0 ヶ月';
            if(totalTimeDaysDisplay) totalTimeDaysDisplay.textContent = '0.0 日';
            if(totalTimeHoursDisplay) totalTimeHoursDisplay.textContent = '0.0 時間';
            if(ratioPlayToTotalSinceStartPercentDisplay) ratioPlayToTotalSinceStartPercentDisplay.textContent = '0.00 %';
            if(ratioPlayDaysValDisplay) ratioPlayDaysValDisplay.textContent = '0';
            if(ratioPlayDaysTotalDisplay) ratioPlayDaysTotalDisplay.textContent = '0'; 
            if(ratioPlayHoursValDisplay) ratioPlayHoursValDisplay.textContent = '0';
            if(ratioPlayHoursTotalDisplay) ratioPlayHoursTotalDisplay.textContent = '0'; 
            if(ratioPlayToLifePercentDisplay) ratioPlayToLifePercentDisplay.textContent = '0.00 %';
            if(ratioLifeDaysValDisplay) ratioLifeDaysValDisplay.textContent = '0';
            if(ratioLifeDaysTotalDisplay) ratioLifeDaysTotalDisplay.textContent = '0'; 
            if(ratioLifeHoursValDisplay) ratioLifeHoursValDisplay.textContent = '0';
            if(ratioLifeHoursTotalDisplay) ratioLifeHoursTotalDisplay.textContent = '0'; 
            if(qualificationIntroTextDisplay) qualificationIntroTextDisplay.textContent = '';


            const vrchatStartDateObj = getDateFromInputs('vrchatStartYear', 'vrchatStartMonth', 'vrchatStartDay', "VRChatを始めた日");
            if (!vrchatStartDateObj) return;
            const vrchatPlayTimeString = vrchatPlayTimeInput.value;
            if (!vrchatPlayTimeString) {
                showError("VRChatのプレイ時間を入力してください。"); return;
            }
            const vrchatPlayTimeHours = parseFloat(vrchatPlayTimeString);
            if (isNaN(vrchatPlayTimeHours) || vrchatPlayTimeHours < 0) {
                showError("VRChatのプレイ時間は有効な正の数値を入力してください。"); return;
            }
            let birthDateObj = null;
            const birthYearVal = birthYearInput.value;
            const birthMonthVal = birthMonthInput.value;
            const birthDayVal = birthDayInput.value;
            if (birthYearVal || birthMonthVal || birthDayVal) {
                birthDateObj = getDateFromInputs('birthYear', 'birthMonth', 'birthDay', "生年月日");
                if (!birthDateObj && (birthYearVal || birthMonthVal || birthDayVal)) return;
            }

            const now = new Date();
            if (vrchatStartDateObj > now) { showError("VRChatを始めた日は未来の日付にできません。"); return; }
            if (birthDateObj && birthDateObj > now) { showError("生年月日は未来の日付にできません。"); return; }
            if (birthDateObj && birthDateObj > vrchatStartDateObj) { showError("生年月日がVRChatを始めた日より後になっています。"); return; }

            resultsArea.classList.remove('hidden');
            if (resultsArea) {
                resultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }


            try {
                const totalMsSinceStart = now.getTime() - vrchatStartDateObj.getTime();
                if (totalMsSinceStart < 0) { showError("VRChat開始日が未来になっています。"); return; }

                await showElementWithAnimation(totalTimeSection, 0); 
                const ymdData = calculateYearsMonthsDays(vrchatStartDateObj, now);
                
                const totalMonthsVal = totalMsSinceStart / (MS_PER_DAY * DAYS_PER_MONTH_AVG);
                const totalDaysVal = totalMsSinceStart / MS_PER_DAY;
                const totalHoursVal = totalMsSinceStart / MS_PER_HOUR;

                const animationPromises = [];
                animationPromises.push(animateYMDDisplayCombined(ymdData));
                
                const startMonthsAnimation = () => new Promise(resolve => 
                    setTimeout(() => resolve(animateCountUp(totalTimeMonthsDisplay, totalMonthsVal, BASE_ANIMATION_DURATION, 1, " ヶ月")), ITEM_ANIM_DELAY)
                );
                animationPromises.push(startMonthsAnimation());

                const startDaysAnimation = () => new Promise(resolve => 
                    setTimeout(() => resolve(animateCountUp(totalTimeDaysDisplay, totalDaysVal, BASE_ANIMATION_DURATION, 1, " 日")), ITEM_ANIM_DELAY * 2)
                );
                animationPromises.push(startDaysAnimation());
                
                const startHoursAnimation = () => new Promise(resolve => 
                    setTimeout(() => resolve(animateCountUp(totalTimeHoursDisplay, totalHoursVal, BASE_ANIMATION_DURATION, 1, " 時間")), ITEM_ANIM_DELAY * 3)
                );
                animationPromises.push(startHoursAnimation());
                
                await Promise.all(animationPromises);
                await new Promise(r => setTimeout(r, DELAY_AFTER_TOTAL_TIME_SECTION));

                await showElementWithAnimation(playRatioSection, 0);
                const vrchatPlayTimeHoursInt = Math.floor(vrchatPlayTimeHours);
                const vrchatPlayTimeDaysInt = Math.floor(vrchatPlayTimeHours / 24);
                let ratioPlayPercentVal = 0;
                if (totalHoursVal > 0) {
                    ratioPlayPercentVal = (vrchatPlayTimeHours / totalHoursVal) * 100;
                }
                animateBar(ratioPlayBar, ratioPlayPercentVal);
                if (ratioPlayPercentVal > 100 && playRatioOverflowDisplay) {
                    playRatioOverflowDisplay.classList.remove('hidden');
                } else if (playRatioOverflowDisplay) {
                    playRatioOverflowDisplay.classList.add('hidden');
                }

                const playRatioAnimations = [
                    animateCountUp(ratioPlayToTotalSinceStartPercentDisplay, ratioPlayPercentVal, BASE_ANIMATION_DURATION, 2, " %"),
                    animateCountUp(ratioPlayDaysValDisplay, vrchatPlayTimeDaysInt, BASE_ANIMATION_DURATION, 0, ""),
                    animateCountUp(ratioPlayDaysTotalDisplay, Math.floor(totalDaysVal), BASE_ANIMATION_DURATION, 0, "日"),
                    animateCountUp(ratioPlayHoursValDisplay, vrchatPlayTimeHoursInt, BASE_ANIMATION_DURATION, 0, ""),
                    animateCountUp(ratioPlayHoursTotalDisplay, Math.floor(totalHoursVal), BASE_ANIMATION_DURATION, 0, "時間")
                ];
                await Promise.all(playRatioAnimations);

                let lifeRatioPercentVal = 0; 
                let totalLifeDaysVal = 0;
                let totalLifeHoursVal = 0;
                
                if (birthDateObj) { 
                    await new Promise(r => setTimeout(r, ITEM_ANIM_DELAY)); 
                    await showElementWithAnimation(lifeRatioSection, 0); 

                    const totalLifeMs = now.getTime() - birthDateObj.getTime(); 
                    if (totalLifeMs < 0) { showError("生年月日が未来になっています。"); return; }
                    
                    totalLifeHoursVal = totalLifeMs / MS_PER_HOUR; 
                    totalLifeDaysVal = totalLifeMs / MS_PER_DAY;   
                    
                    if (totalLifeHoursVal > 0) {
                        lifeRatioPercentVal = (vrchatPlayTimeHours / totalLifeHoursVal) * 100;
                    }
                    animateBar(ratioLifeBar, lifeRatioPercentVal);
                    if (lifeRatioPercentVal > 100 && lifeRatioOverflowDisplay) {
                        lifeRatioOverflowDisplay.classList.remove('hidden');
                    } else if (lifeRatioOverflowDisplay) {
                        lifeRatioOverflowDisplay.classList.add('hidden');
                    }

                    const lifeRatioAnimations = [
                        animateCountUp(ratioPlayToLifePercentDisplay, lifeRatioPercentVal, BASE_ANIMATION_DURATION, 2, " %"),
                        animateCountUp(ratioLifeDaysValDisplay, vrchatPlayTimeDaysInt, BASE_ANIMATION_DURATION, 0, ""),
                        animateCountUp(ratioLifeDaysTotalDisplay, Math.floor(totalLifeDaysVal), BASE_ANIMATION_DURATION, 0, "日"),
                        animateCountUp(ratioLifeHoursValDisplay, vrchatPlayTimeHoursInt, BASE_ANIMATION_DURATION, 0, ""),
                        animateCountUp(ratioLifeHoursTotalDisplay, Math.floor(totalLifeHoursVal), BASE_ANIMATION_DURATION, 0, "時間")
                    ];
                    await Promise.all(lifeRatioAnimations);

                } else {
                    lifeRatioSection.classList.add('hidden'); 
                    lifeRatioSection.classList.remove('is-visible');
                }

                let suggestedQualificationsList = [];
                if (vrchatPlayTimeHours >= 4000) {
                    const sortedForHighHours = [...qualifications].sort((a, b) => b.minHours - a.minHours);
                    suggestedQualificationsList = sortedForHighHours.slice(0, 2);
                } else {
                    suggestedQualificationsList = qualifications.filter(qual => 
                        vrchatPlayTimeHours >= qual.minHours && vrchatPlayTimeHours <= qual.maxHours
                    ).slice(0, 3);
                }
                
                qualificationCardsContainer.innerHTML = ''; 
                if (suggestedQualificationsList.length > 0) {
                    qualificationIntroTextDisplay.textContent = `${vrchatPlayTimeHours.toFixed(0)}時間 (${(vrchatPlayTimeHours/24).toFixed(1)}日) あればこんな資格をとれたかも?`;
                    suggestedQualificationsList.forEach(qual => {
                        const card = document.createElement('div');
                        card.className = 'qualification-card';
                        card.innerHTML = `
                            <h4 class="qualification-name">${qual.name}</h4>
                            <p class="qualification-study-time">平均勉強時間 ${qual.minHours}～${qual.maxHours}時間</p>
                            <p class="qualification-description">${qual.description}</p>
                        `;
                        qualificationCardsContainer.appendChild(card);
                    });
                    await showElementWithAnimation(qualificationSuggestionSection, DELAY_AFTER_RATIO_SECTION);
                } else {
                    qualificationSuggestionSection.classList.add('hidden');
                    qualificationSuggestionSection.classList.remove('is-visible');
                }


                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth() + 1;
                const currentDateVal = now.getDate();
                const currentDateText = `(${currentYear}年${currentMonth}月${currentDateVal}日 現在)`;
                currentDateDisplay.textContent = currentDateText;
                await showElementWithAnimation(currentDateDisplay, 0);

                lastCalculatedResults = {
                    vrchatStartDate: `${vrchatStartYearInput.value}年 ${vrchatStartMonthInput.value}月 ${vrchatStartDayInput.value}日`,
                    vrchatPlayTime: vrchatPlayTimeInput.value + "時間",
                    birthDate: birthDateObj ? `${birthYearInput.value}年 ${birthMonthInput.value}月 ${birthDayInput.value}日` : "未入力",
                    ymd: `${ymdData.years}年 ${ymdData.months}ヶ月 ${ymdData.days}日`,
                    totalMonths: totalMonthsVal.toFixed(1) + " ヶ月",
                    totalDays: totalDaysVal.toFixed(1) + " 日",
                    totalHours: totalHoursVal.toFixed(1) + " 時間",
                    playRatioPercent: ratioPlayPercentVal.toFixed(2) + "%",
                    playRatioDaysDetail: `${vrchatPlayTimeDaysInt}日 / ${Math.floor(totalDaysVal)}日`,
                    playRatioHoursDetail: `${vrchatPlayTimeHoursInt}時間 / ${Math.floor(totalHoursVal)}時間`,
                    isLifeRatioCalculated: !!birthDateObj, 
                    lifeRatioPercent: lifeRatioPercentVal.toFixed(2) + "%",
                    lifeRatioDaysDetail: `${vrchatPlayTimeDaysInt}日 / ${Math.floor(totalLifeDaysVal)}日`,
                    lifeRatioHoursDetail: `${vrchatPlayTimeHoursInt}時間 / ${Math.floor(totalLifeHoursVal)}時間`,
                    suggestedQualifications: suggestedQualificationsList.map(q => ({name: q.name, time: `${q.minHours}～${q.maxHours}時間`, desc: q.description})),
                    currentDate: currentDateText
                };
                copyButton.classList.remove('hidden'); 
                

            } catch (error) {
                console.error("Calculation error:", error);
                showError("計算中に予期せぬエラーが発生しました。入力値を確認してください。");
                copyButton.classList.add('hidden'); 
            }
        });

        copyButton.addEventListener('click', () => {
            if (!lastCalculatedResults) {
                console.warn("コピーする計算結果がありません。");
                copyButton.textContent = '結果なし';
                 setTimeout(() => {
                    copyButton.textContent = '結果をコピーする';
                }, 2000);
                return;
            }
            
            let textToCopy = `VRChatを始めた日:[${lastCalculatedResults.vrchatStartDate}]\n`;
            textToCopy += `VRChatの総プレイ時間:[${lastCalculatedResults.vrchatPlayTime}]\n`;
            if (lastCalculatedResults.isLifeRatioCalculated && lastCalculatedResults.birthDate !== "未入力") {
                textToCopy += `あなたの生年月日:[${lastCalculatedResults.birthDate}]\n\n\n`;
            } else {
                textToCopy += "\n\n";
            }

            textToCopy += "VRChatプレイ時間分析結果:\n\n";
            textToCopy += `・VRChat開始からの総経過時間:\n\n`;
            textToCopy += `  - 年月日: ${lastCalculatedResults.ymd}\n`;
            textToCopy += `  - 総月数: ${lastCalculatedResults.totalMonths}\n`;
            textToCopy += `  - 総日数: ${lastCalculatedResults.totalDays}\n`;
            textToCopy += `  - 総時間数: ${lastCalculatedResults.totalHours}\n\n\n`;

            textToCopy += `・VRChatを始めてからのプレイ時間比率:\n`;
            textToCopy += `< ${lastCalculatedResults.playRatioPercent} >`;
            if (parseFloat(lastCalculatedResults.playRatioPercent) > 100) textToCopy += " (Overflowing)";
            textToCopy += `\n[${lastCalculatedResults.playRatioDaysDetail}, ${lastCalculatedResults.playRatioHoursDetail}]\n\n\n`;

            if (lastCalculatedResults.isLifeRatioCalculated) {
                textToCopy += `・あなたの人生に対するプレイ時間比率:\n`;
                textToCopy += `< ${lastCalculatedResults.lifeRatioPercent} >`;
                if (parseFloat(lastCalculatedResults.lifeRatioPercent) > 100) textToCopy += " (Overflowing)";
                textToCopy += `\n[${lastCalculatedResults.lifeRatioDaysDetail}, ${lastCalculatedResults.lifeRatioHoursDetail}]\n\n`;
            }

            if (lastCalculatedResults.suggestedQualifications && lastCalculatedResults.suggestedQualifications.length > 0) {
                 textToCopy += `・${lastCalculatedResults.vrchatPlayTime} あればこんな資格をとれたかも?\n`;
                 lastCalculatedResults.suggestedQualifications.forEach(qual => {
                     textToCopy += `${qual.name}\n`;
                     textToCopy += `  平均勉強時間 ${qual.time}\n`;
                     textToCopy += `  ${qual.desc}\n\n`;
                 });
            }

            textToCopy += `${lastCalculatedResults.currentDate}`;

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                copyButton.textContent = 'コピーしました！';
                setTimeout(() => {
                    copyButton.textContent = '結果をコピーする';
                }, 2000);
            } catch (err) {
                console.error('コピーに失敗しました', err);
                copyButton.textContent = 'コピー失敗';
                 setTimeout(() => {
                    copyButton.textContent = '結果をコピーする';
                }, 2000);
            }
            document.body.removeChild(textarea);
        });


        function calculateYearsMonthsDays(startDate, endDate) {
            let years = endDate.getFullYear() - startDate.getFullYear();
            let months = endDate.getMonth() - startDate.getMonth();
            let days = endDate.getDate() - startDate.getDate();
            if (days < 0) {
                months--;
                const prevMonthLastDay = new Date(endDate.getFullYear(), endDate.getMonth(), 0).getDate();
                days += prevMonthLastDay;
            }
            if (months < 0) { years--; months += 12; }
            return { years, months, days };
        }

        function showError(message) {
            errorDisplay.textContent = message;
            errorDisplay.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            copyButton.classList.add('hidden'); 
        }
    </script>
</body>
</html>
