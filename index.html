<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRChat プレイ時間分析ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .creator-credit {
            font-size: 0.8rem;
            color: #6b7280;
            text-align: center;
            width: 100%;
            padding-top: 0.5rem; 
            margin-bottom: 0.5rem;
        }
        .container {
            max-width: 700px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 2rem; 
            padding: 2.5rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .input-group legend, .input-group > label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }
        .date-inputs {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .input-field {
            padding: 0.85rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
            text-align: center;
            font-size: 0.95rem;
        }
        .input-field:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        .input-year { width: 6rem; }
        .input-month-day { width: 4.5rem; }
        #vrchatPlayTime {
            width: 11rem;
        }
        .btn {
            display: inline-block;
            padding: 0.85rem 1.75rem;
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            border: none;
            width: 100%;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn:hover {
            background-color: #4338ca;
        }
        .btn:active {
            transform: translateY(1px);
        }
        .btn-copy {
            background-color: #0ea5e9;
            margin-top: 1.5rem;
        }
        .btn-copy:hover {
            background-color: #0284c7;
        }
        .results-card {
            margin-top: 2.5rem;
            padding: 2rem;
            background-color: #f9fafb;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
        }
        .results-card h3 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #111827;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.75rem;
        }
        .result-item {
            margin-bottom: 1.75rem;
            font-size: 1rem;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .result-item.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .result-item strong {
            font-weight: 600;
            color: #374151;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.05rem;
        }
        .result-item .value-span, .result-item .ymd-value-span span {
            color: #4f46e5;
            font-weight: bold;
        }
         .result-item .value-span {
             padding-left: 0.5rem;
         }
        .percent-large {
            font-size: 1.6em;
            font-weight: 700;
            color: #4f46e5;
            display: inline-block;
            margin-bottom: 0.5rem;
            padding-left: 0.5rem;
        }
        .overflow-indicator {
            font-size: 0.6em;
            color: #ef4444;
            margin-left: 0.25rem;
            font-weight: normal;
            vertical-align: middle;
        }
        .ratio-details {
            font-size: 0.95rem;
            color: #4b5563;
            padding-left: 0.5rem;
            margin-top: 0.25rem;
        }
        .ratio-detail-item {
            display: inline-block;
            margin-right: 1.25rem;
            align-items: center;
        }
        .boxed-value {
            border: 1px solid #d1d5db;
            padding: 0.2rem 0.5rem;
            border-radius: 0.375rem;
            background-color: #eef2ff;
            display: inline-block;
            margin-left: 0.35rem;
        }
        .boxed-value .animated-value {
            font-weight: bold;
            color: #4f46e5;
        }
        .result-sub-item {
            padding-left: 1rem;
            margin-bottom: 0.6rem;
            font-size: 0.95rem;
        }
        .result-sub-item strong {
            font-weight: 500;
            color: #4b5563;
        }
        .current-date-display {
            font-size: 0.85em;
            color: #6b7280;
            text-align: right;
            margin-top: 1rem;
            opacity: 0;
            transition: opacity 0.5s ease-out 0.2s;
        }
        .current-date-display.is-visible {
            opacity: 1;
        }
        .error-message {
            color: #ef4444;
            background-color: #fee2e2;
            border: 1px solid #fca5a5;
            padding: 0.85rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
            font-size: 0.95rem;
        }
        .optional-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-left: 0.5rem;
            font-weight: normal;
        }
        .ratio-bar-container {
            width: 100%;
            height: 14px;
            background-color: #e5e7eb;
            border-radius: 7px;
            margin-top: 0.75rem;
            overflow: hidden;
        }
        .ratio-bar {
            width: 0%;
            height: 100%;
            background-color: #6366f1;
            border-radius: 7px;
            transition: width 1.2s ease-out;
        }
        @media (max-width: 640px) {
            body { padding: 0.5rem; }
            .container { margin-top: 1rem; margin-bottom: 1rem; padding: 1.5rem; }
            .creator-credit { margin-bottom: 0.25rem; padding-top: 0.25rem;}
            .date-inputs { flex-wrap: wrap; gap: 0.5rem; }
            .input-year, .input-month-day, #vrchatPlayTime { width: 100%; margin-bottom: 0.5rem;}
            .date-inputs span.text-gray-500 { margin: 0 0.25rem; }
            .ratio-detail-item { display: block; margin-right: 0; margin-bottom: 0.5rem; }
            .current-date-display { text-align: center; margin-top: 1.5rem; }
            .results-card h3 { font-size: 1.25rem; }
            .percent-large { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="creator-credit">Created by, poko_VRC</div>
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-10 text-indigo-700">VRChat プレイ時間分析ツール</h1>

        <div class="space-y-8">
            <fieldset class="input-group">
                <legend>VRChatを始めた日:</legend>
                <div class="date-inputs">
                    <input type="number" id="vrchatStartYear" class="input-field input-year" placeholder="YYYY" min="1900" max="2100">
                    <span class="text-gray-500">年</span>
                    <input type="number" id="vrchatStartMonth" class="input-field input-month-day" placeholder="MM" min="1" max="12">
                    <span class="text-gray-500">月</span>
                    <input type="number" id="vrchatStartDay" class="input-field input-month-day" placeholder="DD" min="1" max="31">
                    <span class="text-gray-500">日</span>
                </div>
            </fieldset>
            <div class="input-group">
                <label for="vrchatPlayTime">VRChatの総プレイ時間 (時間):</label>
                <input type="number" id="vrchatPlayTime" class="input-field" placeholder="例: 1500" min="0">
            </div>
            <fieldset class="input-group">
                <legend>あなたの生年月日 <span class="optional-text">(任意入力)</span></legend>
                <div class="date-inputs">
                    <input type="number" id="birthYear" class="input-field input-year" placeholder="YYYY" min="1900" max="2100">
                    <span class="text-gray-500">年</span>
                    <input type="number" id="birthMonth" class="input-field input-month-day" placeholder="MM" min="1" max="12">
                    <span class="text-gray-500">月</span>
                    <input type="number" id="birthDay" class="input-field input-month-day" placeholder="DD" min="1" max="31">
                    <span class="text-gray-500">日</span>
                </div>
            </fieldset>
        </div>

        <button id="calculateButton" class="btn mt-10">計算する</button>
        <div id="errorDisplay" class="error-message hidden mt-6"></div>

        <div id="resultsArea" class="results-card hidden">
            <h3>計算結果:</h3>
            <div id="totalTimeSection" class="result-item">
                <strong>VRChat開始からの総経過時間:</strong>
                <div class="result-sub-item">
                    <strong>年・月・日:</strong>
                    <span class="ymd-value-span">
                        <span id="totalTimeYears">0</span>年
                        <span id="totalTimeMonthsVal">0</span>ヶ月
                        <span id="totalTimeDaysVal">0</span>日
                    </span>
                </div>
                <div class="result-sub-item">
                    <strong>総月数:</strong> <span id="totalTimeMonths" class="value-span">0.0 ヶ月</span>
                </div>
                <div class="result-sub-item">
                    <strong>総日数:</strong> <span id="totalTimeDays" class="value-span">0.0 日</span>
                </div>
                <div class="result-sub-item">
                    <strong>総時間数:</strong> <span id="totalTimeHours" class="value-span">0.0 時間</span>
                </div>
            </div>
            <div id="playRatioSection" class="result-item">
                <strong>VRChatを始めてからのプレイ時間比率:</strong>
                <span id="ratioPlayToTotalSinceStartPercent" class="percent-large">0.00 %</span>
                <span id="playRatioOverflow" class="overflow-indicator hidden">(Overflowing)</span>
                <div class="ratio-bar-container">
                    <div id="ratioPlayBar" class="ratio-bar"></div>
                </div>
                <div class="ratio-details">
                    <span class="ratio-detail-item">日数: <span class="boxed-value">
                        <span id="ratioPlayDaysVal" class="animated-value">0</span>日 / <span id="ratioPlayDaysTotal" class="animated-value">0</span>日
                    </span></span>
                    <span class="ratio-detail-item">時間: <span class="boxed-value">
                        <span id="ratioPlayHoursVal" class="animated-value">0</span>時間 / <span id="ratioPlayHoursTotal" class="animated-value">0</span>時間
                    </span></span>
                </div>
            </div>
            <div id="lifeRatioSection" class="result-item hidden">
                <strong>あなたの人生に対するプレイ時間比率:</strong>
                <span id="ratioPlayToLifePercent" class="percent-large">0.00 %</span>
                <span id="lifeRatioOverflow" class="overflow-indicator hidden">(Overflowing)</span>
                <div class="ratio-bar-container">
                    <div id="ratioLifeBar" class="ratio-bar"></div>
                </div>
                 <div class="ratio-details">
                    <span class="ratio-detail-item">日数: <span class="boxed-value">
                        <span id="ratioLifeDaysVal" class="animated-value">0</span>日 / <span id="ratioLifeDaysTotal" class="animated-value">0</span>日
                    </span></span>
                    <span class="ratio-detail-item">時間: <span class="boxed-value">
                        <span id="ratioLifeHoursVal" class="animated-value">0</span>時間 / <span id="ratioLifeHoursTotal" class="animated-value">0</span>時間
                    </span></span>
                </div>
            </div>
            <div id="currentDateDisplay" class="current-date-display"></div>
            <button id="copyButton" class="btn btn-copy hidden">結果をコピーする</button>
        </div>
    </div>

    <script>
        const calculateButton = document.getElementById('calculateButton');
        const resultsArea = document.getElementById('resultsArea');
        const errorDisplay = document.getElementById('errorDisplay');
        const copyButton = document.getElementById('copyButton'); 

        const totalTimeSection = document.getElementById('totalTimeSection');
        const playRatioSection = document.getElementById('playRatioSection');
        const lifeRatioSection = document.getElementById('lifeRatioSection');
        const currentDateDisplay = document.getElementById('currentDateDisplay');

        const vrchatStartYearInput = document.getElementById('vrchatStartYear');
        const vrchatStartMonthInput = document.getElementById('vrchatStartMonth');
        const vrchatStartDayInput = document.getElementById('vrchatStartDay');
        const vrchatPlayTimeInput = document.getElementById('vrchatPlayTime');
        const birthYearInput = document.getElementById('birthYear');
        const birthMonthInput = document.getElementById('birthMonth');
        const birthDayInput = document.getElementById('birthDay');


        const totalTimeYearsDisplay = document.getElementById('totalTimeYears');
        const totalTimeMonthsValDisplay = document.getElementById('totalTimeMonthsVal');
        const totalTimeDaysValDisplay = document.getElementById('totalTimeDaysVal');
        const totalTimeMonthsDisplay = document.getElementById('totalTimeMonths');
        const totalTimeDaysDisplay = document.getElementById('totalTimeDays');
        const totalTimeHoursDisplay = document.getElementById('totalTimeHours');
        const ratioPlayToTotalSinceStartPercentDisplay = document.getElementById('ratioPlayToTotalSinceStartPercent');
        const playRatioOverflowDisplay = document.getElementById('playRatioOverflow'); 
        const ratioPlayDaysValDisplay = document.getElementById('ratioPlayDaysVal');
        const ratioPlayDaysTotalDisplay = document.getElementById('ratioPlayDaysTotal');
        const ratioPlayHoursValDisplay = document.getElementById('ratioPlayHoursVal');
        const ratioPlayHoursTotalDisplay = document.getElementById('ratioPlayHoursTotal');

        const ratioPlayToLifePercentDisplay = document.getElementById('ratioPlayToLifePercent');
        const lifeRatioOverflowDisplay = document.getElementById('lifeRatioOverflow'); 
        const ratioLifeDaysValDisplay = document.getElementById('ratioLifeDaysVal');
        const ratioLifeDaysTotalDisplay = document.getElementById('ratioLifeDaysTotal');
        const ratioLifeHoursValDisplay = document.getElementById('ratioLifeHoursVal');
        const ratioLifeHoursTotalDisplay = document.getElementById('ratioLifeHoursTotal');
        const ratioPlayBar = document.getElementById('ratioPlayBar');
        const ratioLifeBar = document.getElementById('ratioLifeBar');

        const MS_PER_HOUR = 1000 * 60 * 60;
        const MS_PER_DAY = MS_PER_HOUR * 24;
        const DAYS_PER_YEAR_AVG = 365.25;
        const DAYS_PER_MONTH_AVG = DAYS_PER_YEAR_AVG / 12;
        
        const BASE_ANIMATION_DURATION = 1500; 
        const YMD_ITEM_ANIM_DURATION = 1000;  
        const ITEM_ANIM_DELAY = 300; 
        const SECTION_FADE_IN_DELAY = 150;
        const DELAY_AFTER_TOTAL_TIME_SECTION = 400; 

        let lastCalculatedResults = null;


        function easeOutCubic(t) {
            return (--t) * t * t + 1;
        }

        function getDateFromInputs(yearInputId, monthInputId, dayInputId, fieldName) {
            const year = parseInt(document.getElementById(yearInputId).value);
            const month = parseInt(document.getElementById(monthInputId).value);
            const day = parseInt(document.getElementById(dayInputId).value);

            if (isNaN(year) || isNaN(month) || isNaN(day)) {
                if (fieldName.includes("生年月日") && !document.getElementById(yearInputId).value && !document.getElementById(monthInputId).value && !document.getElementById(dayInputId).value) {
                    return null;
                }
                showError(`${fieldName}の年・月・日をすべて入力してください。`); return null;
            }
            if (month < 1 || month > 12) {
                showError(`${fieldName}の月は1から12の間で入力してください。`); return null;
            }
            const daysInMonth = new Date(year, month, 0).getDate();
            if (day < 1 || day > daysInMonth) {
                showError(`${fieldName}の日は1から${daysInMonth}の間で入力してください (${year}年${month}月)。`); return null;
            }
            const dateObj = new Date(year, month - 1, day);
            if (dateObj.getFullYear() !== year || dateObj.getMonth() !== month - 1 || dateObj.getDate() !== day) {
                showError(`${fieldName}に存在しない日付が入力されています。`); return null;
            }
            return dateObj;
        }

        function animateCountUp(element, endValue, duration, decimalPlaces = 0, unit = '', startValue = 0) {
            return new Promise(resolve => {
                if (!element) { 
                    resolve();
                    return;
                }
                if (duration <= 0) {
                    element.textContent = `${endValue.toFixed(decimalPlaces)}${unit}`;
                    resolve();
                    return;
                }
                let startTime = null;

                function animationStep(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const progress = Math.min((timestamp - startTime) / duration, 1);
                    const easedProgress = easeOutCubic(progress);
                    const currentValue = startValue + (endValue - startValue) * easedProgress;
                    element.textContent = `${currentValue.toFixed(decimalPlaces)}${unit}`;
                    if (progress < 1) {
                        requestAnimationFrame(animationStep);
                    } else {
                        element.textContent = `${endValue.toFixed(decimalPlaces)}${unit}`;
                        resolve();
                    }
                }
                requestAnimationFrame(animationStep);
            });
        }
        
        async function animateYMDDisplayCombined(targetYMD) {
            const { years, months, days } = targetYMD;
            await Promise.all([
                animateCountUp(totalTimeYearsDisplay, years, YMD_ITEM_ANIM_DURATION, 0),
                animateCountUp(totalTimeMonthsValDisplay, months, YMD_ITEM_ANIM_DURATION, 0),
                animateCountUp(totalTimeDaysValDisplay, days, YMD_ITEM_ANIM_DURATION, 0)
            ]);
        }

        function animateBar(barElement, percentage) {
            if (!barElement) {
                return;
            }
            requestAnimationFrame(() => {
                   barElement.style.width = `${Math.min(100, Math.max(0, percentage))}%`;
            });
        }
        
        async function showElementWithAnimation(element, delay = SECTION_FADE_IN_DELAY) {
            if (!element) return;
            return new Promise(resolve => {
                element.classList.remove('hidden');
                requestAnimationFrame(() => { 
                    setTimeout(() => { 
                        element.classList.add('is-visible');
                        resolve();
                    }, delay); 
                });
            });
        }


        calculateButton.addEventListener('click', async () => {
            errorDisplay.classList.add('hidden');
            errorDisplay.textContent = '';
            resultsArea.classList.add('hidden');
            copyButton.classList.add('hidden'); 
            lastCalculatedResults = null; 
            
            [totalTimeSection, playRatioSection, lifeRatioSection, currentDateDisplay].forEach(el => {
                if(el) {
                    el.classList.remove('is-visible');
                    if (el.id === 'lifeRatioSection') {
                         el.classList.add('hidden');
                    }
                }
            });
            if(playRatioOverflowDisplay) playRatioOverflowDisplay.classList.add('hidden');
            if(lifeRatioOverflowDisplay) lifeRatioOverflowDisplay.classList.add('hidden');


            if(ratioPlayBar) {
                ratioPlayBar.style.transition = 'none';
                ratioPlayBar.style.width = '0%';
                requestAnimationFrame(() => ratioPlayBar.style.transition = 'width 1.2s ease-out');
            }
            if(ratioLifeBar) {
                ratioLifeBar.style.transition = 'none';
                ratioLifeBar.style.width = '0%';
                requestAnimationFrame(() => ratioLifeBar.style.transition = 'width 1.2s ease-out');
            }
            
            if(totalTimeYearsDisplay) totalTimeYearsDisplay.textContent = '0';
            if(totalTimeMonthsValDisplay) totalTimeMonthsValDisplay.textContent = '0';
            if(totalTimeDaysValDisplay) totalTimeDaysValDisplay.textContent = '0';
            if(totalTimeMonthsDisplay) totalTimeMonthsDisplay.textContent = '0.0 ヶ月';
            if(totalTimeDaysDisplay) totalTimeDaysDisplay.textContent = '0.0 日';
            if(totalTimeHoursDisplay) totalTimeHoursDisplay.textContent = '0.0 時間';
            if(ratioPlayToTotalSinceStartPercentDisplay) ratioPlayToTotalSinceStartPercentDisplay.textContent = '0.00 %';
            if(ratioPlayDaysValDisplay) ratioPlayDaysValDisplay.textContent = '0';
            if(ratioPlayDaysTotalDisplay) ratioPlayDaysTotalDisplay.textContent = '0'; 
            if(ratioPlayHoursValDisplay) ratioPlayHoursValDisplay.textContent = '0';
            if(ratioPlayHoursTotalDisplay) ratioPlayHoursTotalDisplay.textContent = '0'; 
            if(ratioPlayToLifePercentDisplay) ratioPlayToLifePercentDisplay.textContent = '0.00 %';
            if(ratioLifeDaysValDisplay) ratioLifeDaysValDisplay.textContent = '0';
            if(ratioLifeDaysTotalDisplay) ratioLifeDaysTotalDisplay.textContent = '0'; 
            if(ratioLifeHoursValDisplay) ratioLifeHoursValDisplay.textContent = '0';
            if(ratioLifeHoursTotalDisplay) ratioLifeHoursTotalDisplay.textContent = '0'; 


            const vrchatStartDateObj = getDateFromInputs('vrchatStartYear', 'vrchatStartMonth', 'vrchatStartDay', "VRChatを始めた日");
            if (!vrchatStartDateObj) return;
            const vrchatPlayTimeString = vrchatPlayTimeInput.value;
            if (!vrchatPlayTimeString) {
                showError("VRChatのプレイ時間を入力してください。"); return;
            }
            const vrchatPlayTimeHours = parseFloat(vrchatPlayTimeString);
            if (isNaN(vrchatPlayTimeHours) || vrchatPlayTimeHours < 0) {
                showError("VRChatのプレイ時間は有効な正の数値を入力してください。"); return;
            }
            let birthDateObj = null;
            const birthYearVal = birthYearInput.value;
            const birthMonthVal = birthMonthInput.value;
            const birthDayVal = birthDayInput.value;
            if (birthYearVal || birthMonthVal || birthDayVal) {
                birthDateObj = getDateFromInputs('birthYear', 'birthMonth', 'birthDay', "生年月日");
                if (!birthDateObj && (birthYearVal || birthMonthVal || birthDayVal)) return;
            }

            const now = new Date();
            if (vrchatStartDateObj > now) { showError("VRChatを始めた日は未来の日付にできません。"); return; }
            if (birthDateObj && birthDateObj > now) { showError("生年月日は未来の日付にできません。"); return; }
            if (birthDateObj && birthDateObj > vrchatStartDateObj) { showError("生年月日がVRChatを始めた日より後になっています。"); return; }

            resultsArea.classList.remove('hidden');

            try {
                const totalMsSinceStart = now.getTime() - vrchatStartDateObj.getTime();
                if (totalMsSinceStart < 0) { showError("VRChat開始日が未来になっています。"); return; }

                await showElementWithAnimation(totalTimeSection, 0); 
                const ymdData = calculateYearsMonthsDays(vrchatStartDateObj, now);
                
                const totalMonthsVal = totalMsSinceStart / (MS_PER_DAY * DAYS_PER_MONTH_AVG);
                const totalDaysVal = totalMsSinceStart / MS_PER_DAY;
                const totalHoursVal = totalMsSinceStart / MS_PER_HOUR;

                const animationPromises = [];
                animationPromises.push(animateYMDDisplayCombined(ymdData));
                
                const startMonthsAnimation = () => new Promise(resolve => 
                    setTimeout(() => resolve(animateCountUp(totalTimeMonthsDisplay, totalMonthsVal, BASE_ANIMATION_DURATION, 1, " ヶ月")), ITEM_ANIM_DELAY)
                );
                animationPromises.push(startMonthsAnimation());

                const startDaysAnimation = () => new Promise(resolve => 
                    setTimeout(() => resolve(animateCountUp(totalTimeDaysDisplay, totalDaysVal, BASE_ANIMATION_DURATION, 1, " 日")), ITEM_ANIM_DELAY * 2)
                );
                animationPromises.push(startDaysAnimation());
                
                const startHoursAnimation = () => new Promise(resolve => 
                    setTimeout(() => resolve(animateCountUp(totalTimeHoursDisplay, totalHoursVal, BASE_ANIMATION_DURATION, 1, " 時間")), ITEM_ANIM_DELAY * 3)
                );
                animationPromises.push(startHoursAnimation());
                
                await Promise.all(animationPromises);
                await new Promise(r => setTimeout(r, DELAY_AFTER_TOTAL_TIME_SECTION));

                await showElementWithAnimation(playRatioSection, 0);
                const vrchatPlayTimeHoursInt = Math.floor(vrchatPlayTimeHours);
                const vrchatPlayTimeDaysInt = Math.floor(vrchatPlayTimeHours / 24);
                let ratioPlayPercentVal = 0;
                if (totalHoursVal > 0) {
                    ratioPlayPercentVal = (vrchatPlayTimeHours / totalHoursVal) * 100;
                }
                animateBar(ratioPlayBar, ratioPlayPercentVal);
                if (ratioPlayPercentVal > 100 && playRatioOverflowDisplay) {
                    playRatioOverflowDisplay.classList.remove('hidden');
                } else if (playRatioOverflowDisplay) {
                    playRatioOverflowDisplay.classList.add('hidden');
                }

                const playRatioAnimations = [
                    animateCountUp(ratioPlayToTotalSinceStartPercentDisplay, ratioPlayPercentVal, BASE_ANIMATION_DURATION, 2, " %"),
                    animateCountUp(ratioPlayDaysValDisplay, vrchatPlayTimeDaysInt, BASE_ANIMATION_DURATION, 0, ""),
                    animateCountUp(ratioPlayDaysTotalDisplay, Math.floor(totalDaysVal), BASE_ANIMATION_DURATION, 0, "日"),
                    animateCountUp(ratioPlayHoursValDisplay, vrchatPlayTimeHoursInt, BASE_ANIMATION_DURATION, 0, ""),
                    animateCountUp(ratioPlayHoursTotalDisplay, Math.floor(totalHoursVal), BASE_ANIMATION_DURATION, 0, "時間")
                ];
                await Promise.all(playRatioAnimations);

                let lifeRatioPercentVal = 0; 
                let totalLifeDaysVal = 0;
                let totalLifeHoursVal = 0;

                if (birthDateObj) { 
                    await new Promise(r => setTimeout(r, ITEM_ANIM_DELAY)); 
                    await showElementWithAnimation(lifeRatioSection, 0); 

                    const totalLifeMs = now.getTime() - birthDateObj.getTime(); 
                    if (totalLifeMs < 0) { showError("生年月日が未来になっています。"); return; }
                    
                    totalLifeHoursVal = totalLifeMs / MS_PER_HOUR; 
                    totalLifeDaysVal = totalLifeMs / MS_PER_DAY;   
                    
                    if (totalLifeHoursVal > 0) {
                        lifeRatioPercentVal = (vrchatPlayTimeHours / totalLifeHoursVal) * 100;
                    }
                    animateBar(ratioLifeBar, lifeRatioPercentVal);
                    if (lifeRatioPercentVal > 100 && lifeRatioOverflowDisplay) {
                        lifeRatioOverflowDisplay.classList.remove('hidden');
                    } else if (lifeRatioOverflowDisplay) {
                        lifeRatioOverflowDisplay.classList.add('hidden');
                    }

                    const lifeRatioAnimations = [
                        animateCountUp(ratioPlayToLifePercentDisplay, lifeRatioPercentVal, BASE_ANIMATION_DURATION, 2, " %"),
                        animateCountUp(ratioLifeDaysValDisplay, vrchatPlayTimeDaysInt, BASE_ANIMATION_DURATION, 0, ""),
                        animateCountUp(ratioLifeDaysTotalDisplay, Math.floor(totalLifeDaysVal), BASE_ANIMATION_DURATION, 0, "日"),
                        animateCountUp(ratioLifeHoursValDisplay, vrchatPlayTimeHoursInt, BASE_ANIMATION_DURATION, 0, ""),
                        animateCountUp(ratioLifeHoursTotalDisplay, Math.floor(totalLifeHoursVal), BASE_ANIMATION_DURATION, 0, "時間")
                    ];
                    await Promise.all(lifeRatioAnimations);

                } else {
                    lifeRatioSection.classList.add('hidden'); 
                    lifeRatioSection.classList.remove('is-visible');
                }

                const currentYear = now.getFullYear();
                const currentMonth = now.getMonth() + 1;
                const currentDateVal = now.getDate();
                const currentDateText = `(${currentYear}年${currentMonth}月${currentDateVal}日 現在)`;
                currentDateDisplay.textContent = currentDateText;
                await showElementWithAnimation(currentDateDisplay, 0);

                lastCalculatedResults = {
                    vrchatStartDate: `${vrchatStartYearInput.value}年 ${vrchatStartMonthInput.value}月 ${vrchatStartDayInput.value}日`,
                    vrchatPlayTime: vrchatPlayTimeInput.value + "時間",
                    birthDate: birthDateObj ? `${birthYearInput.value}年 ${birthMonthInput.value}月 ${birthDayInput.value}日` : "未入力",
                    ymd: `${ymdData.years}年 ${ymdData.months}ヶ月 ${ymdData.days}日`,
                    totalMonths: totalMonthsVal.toFixed(1) + " ヶ月",
                    totalDays: totalDaysVal.toFixed(1) + " 日",
                    totalHours: totalHoursVal.toFixed(1) + " 時間",
                    playRatioPercent: ratioPlayPercentVal.toFixed(2) + "%",
                    playRatioDaysDetail: `${vrchatPlayTimeDaysInt}日 / ${Math.floor(totalDaysVal)}日`,
                    playRatioHoursDetail: `${vrchatPlayTimeHoursInt}時間 / ${Math.floor(totalHoursVal)}時間`,
                    isLifeRatioCalculated: !!birthDateObj, 
                    lifeRatioPercent: lifeRatioPercentVal.toFixed(2) + "%",
                    lifeRatioDaysDetail: `${vrchatPlayTimeDaysInt}日 / ${Math.floor(totalLifeDaysVal)}日`,
                    lifeRatioHoursDetail: `${vrchatPlayTimeHoursInt}時間 / ${Math.floor(totalLifeHoursVal)}時間`,
                    currentDate: currentDateText
                };
                copyButton.classList.remove('hidden'); 

            } catch (error) {
                console.error("Calculation error:", error);
                showError("計算中に予期せぬエラーが発生しました。入力値を確認してください。");
                copyButton.classList.add('hidden'); 
            }
        });

        copyButton.addEventListener('click', () => {
            if (!lastCalculatedResults) {
                console.warn("コピーする計算結果がありません。");
                copyButton.textContent = '結果なし';
                 setTimeout(() => {
                    copyButton.textContent = '結果をコピーする';
                }, 2000);
                return;
            }
            
            let textToCopy = `VRChatを始めた日:[${lastCalculatedResults.vrchatStartDate}]\n`;
            textToCopy += `VRChatの総プレイ時間:[${lastCalculatedResults.vrchatPlayTime}]\n`;
            if (lastCalculatedResults.isLifeRatioCalculated && lastCalculatedResults.birthDate !== "未入力") {
                textToCopy += `あなたの生年月日:[${lastCalculatedResults.birthDate}]\n\n\n`;
            } else {
                textToCopy += "\n\n";
            }

            textToCopy += "VRChatプレイ時間分析結果:\n\n";
            textToCopy += `・VRChat開始からの総経過時間:\n\n`;
            textToCopy += `  - 年月日: ${lastCalculatedResults.ymd}\n`;
            textToCopy += `  - 総月数: ${lastCalculatedResults.totalMonths}\n`;
            textToCopy += `  - 総日数: ${lastCalculatedResults.totalDays}\n`;
            textToCopy += `  - 総時間数: ${lastCalculatedResults.totalHours}\n\n\n`;

            textToCopy += `・VRChatを始めてからのプレイ時間比率:\n`;
            textToCopy += `< ${lastCalculatedResults.playRatioPercent} >`;
            if (parseFloat(lastCalculatedResults.playRatioPercent) > 100) textToCopy += " (Overflowing)";
            textToCopy += `\n[${lastCalculatedResults.playRatioDaysDetail}, ${lastCalculatedResults.playRatioHoursDetail}]\n\n\n`;

            if (lastCalculatedResults.isLifeRatioCalculated) {
                textToCopy += `・あなたの人生に対するプレイ時間比率:\n`;
                textToCopy += `< ${lastCalculatedResults.lifeRatioPercent} >`;
                if (parseFloat(lastCalculatedResults.lifeRatioPercent) > 100) textToCopy += " (Overflowing)";
                textToCopy += `\n[${lastCalculatedResults.lifeRatioDaysDetail}, ${lastCalculatedResults.lifeRatioHoursDetail}]\n\n`;
            }
            textToCopy += `${lastCalculatedResults.currentDate}`;

            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                copyButton.textContent = 'コピーしました！';
                setTimeout(() => {
                    copyButton.textContent = '結果をコピーする';
                }, 2000);
            } catch (err) {
                console.error('コピーに失敗しました', err);
                copyButton.textContent = 'コピー失敗';
                 setTimeout(() => {
                    copyButton.textContent = '結果をコピーする';
                }, 2000);
            }
            document.body.removeChild(textarea);
        });


        function calculateYearsMonthsDays(startDate, endDate) {
            let years = endDate.getFullYear() - startDate.getFullYear();
            let months = endDate.getMonth() - startDate.getMonth();
            let days = endDate.getDate() - startDate.getDate();
            if (days < 0) {
                months--;
                const prevMonthLastDay = new Date(endDate.getFullYear(), endDate.getMonth(), 0).getDate();
                days += prevMonthLastDay;
            }
            if (months < 0) { years--; months += 12; }
            return { years, months, days };
        }

        function showError(message) {
            errorDisplay.textContent = message;
            errorDisplay.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            copyButton.classList.add('hidden'); 
        }
    </script>
</body>
</html>
